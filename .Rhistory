dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
is.null(ori.dt)
exists(ori.dt)
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
exists(ori.dt)
??exists
exists("ori.dt")
shfe <- shfe_grab(date)
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
dates <- seq(from=as.Date("2013-01-01"), to=as.Date("2014-09-30"), by=1)
dates
dates
date
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
library(pipeR)
dates <- seq(from=as.Date("20130101"), to=as.Date("20140930"), by=1)
as.Date("20130101", format="%Y%m%d")
str_replace_all(dates, pattern="-", replacement="")
library(stringr)
stringr::str_replace_all(dates, pattern="-", replacement="")
dates <- seq(from=as.Date("20130101"), to=as.Date("20140930"), by=1) %>>%
stringr::str_replace_all(dates, pattern="-", replacement="")
date <- date[1]
date
stringr::str_replace_all(dates, pattern="-", replacement="")
date <- dates[1]
date
dates <- seq(from=as.Date("20130101"), to=as.Date("20140930"), by=1) %>>%
as.character() %>>%
stringr::str_replace_all( pattern="-", replacement="")
dates <- seq(from=as.Date("20130101"), to=as.Date("20140930"), by=1) %>>%
stringr::str_replace_all( pattern="-", replacement="")
dates <- seq(from=as.Date("20130101"), to=as.Date("20140930"), by=1)
dates <- seq(from=as.Date("2013-01-01"), to=as.Date("2014-09-30"), by=1) %>>%
stringr::str_replace_all( pattern="-", replacement="")
date <- dates[1]
date
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
dt.source
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
ori.dt
dt.source <- paste0("http://www.dce.com.cn/PublicWeb/MainServlet?action=Pu00012_download&Pu00011_Input.trade_date=", date, "&Pu00011_Input.variety=all&Pu00011_Input.trade_type=0&Submit2=%CF%C2%D4%D8%CE%C4%B1%BE%B8%F1%CA%BD")
data <- readLines(dt.source)
data
dt.source <- paste0("http://www.czce.com.cn/portal/exchange/", substr(date, 1, 4),
"/datadaily/", date, ".txt")
data <- read.csv(dt.source, skip=1, header=FALSE, sep=",", stringsAsFactors=FALSE)
dt.source <- paste0("http://www.czce.com.cn/portal/exchange/", substr(date, 1, 4),
"/datadaily/", date, ".txt")
data <- read.csv(dt.source, skip=1, header=FALSE, sep=",", stringsAsFactors=FALSE)
readLines(con=dt.source)
conn <- "http://www.czce.com.cn/portal/exchange/2014/quotation/20130101.htm"
readLines(con=conn)
conn <- "http://www.czce.com.cn/portal/exchange/2014/quotation/20130101.htm"
readLines(con=conn)
dt.source <- paste0("http://www.cffex.com.cn/fzjy/mrhq/",
substr(date, 1, 6), "/", substr(date, 7, 8), "/index.xml")
xml <- XML::xmlParse(dt.source,isURL = TRUE)
data <- XML::xmlToDataFrame(xml,stringsAsFactors = FALSE)
dt.source <- paste0("http://www.dce.com.cn/PublicWeb/MainServlet?action=Pu00012_download&Pu00011_Input.trade_date=", date, "&Pu00011_Input.variety=all&Pu00011_Input.trade_type=0&Submit2=%CF%C2%D4%D8%CE%C4%B1%BE%B8%F1%CA%BD")
data <- readLines(dt.source)
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
ori.dt
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
ori.dt
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
ori.dt
dt.source <- paste0("http://www.czce.com.cn/portal/exchange/", substr(date, 1, 4),
"/datadaily/", date, ".txt")
data <- read.csv(dt.source, skip=1, header=FALSE, sep=",", stringsAsFactors=FALSE)
library(RSQLite)
library(foreach)
source("R files/grab_funs.R")
source("R files/grab_funs.R")
dt.source <- paste0("http://www.czce.com.cn/portal/exchange/", substr(date, 1, 4),
"/datadaily/", date, ".txt")
z <- try(read.csv(dt.source, silent = TRUE) )
z <- try(read.csv(dt.source), silent = TRUE)
z <- try( supressWarnings( read.csv(dt.source), silent = TRUE) )
supressWarnings( z <- try( read.csv(dt.source), silent = TRUE) )
supressWarning( z <- try( read.csv(dt.source), silent = TRUE) )
??supressWarning
z <- supressWarnings( try( read.csv(dt.source), silent = TRUE) )
z <- suppressWarnings( try( read.csv(dt.source), silent = TRUE) )
data <- suppressWarnings( try( read.csv(dt.source), silent = TRUE) )
inherits(z, "try-error")
source("R files/grab_funs.R")
dce <- dce_grab(date)
dce
czce
czce <- czce_grab(date)
czce
cffex <- cffex_grab(date)
shfe <- shfe_grab(date)
shfe
dt.source <- paste0("http://www.cffex.com.cn/fzjy/mrhq/",
substr(date, 1, 6), "/", substr(date, 7, 8), "/index.xml")
xml <- XML::xmlParse(dt.source,isURL = TRUE)
xml <- try( XML::xmlParse(dt.source,isURL = TRUE) )
xml <- try( XML::xmlParse(dt.source,isURL = TRUE), silent=TRUE )
xml
inherits(xml)
xml <- try( XML::xmlParse(dt.source,isURL = TRUE), silent=TRUE )
inherits(xml)
xml <- suppressWarnings( try( XML::xmlParse(dt.source,isURL = TRUE), silent=TRUE ) )
inherits(xml)
try( XML::xmlParse(dt.source,isURL = TRUE), silent=TRUE )
XML::xmlParse(dt.source,isURL = TRUE)
xml <- suppressWarnings( try( XML::xmlParse(dt.source,isURL = TRUE), silent=TRUE ) )
dt.source <- paste0("http://www.cffex.com.cn/fzjy/mrhq/",
substr(date, 1, 6), "/", substr(date, 7, 8), "/index.xml")
xml <- suppressWarnings( try( XML::xmlParse(dt.source,isURL = TRUE), silent=TRUE ) )
inherits(xml)
xml
class(xml)
source("R files/grab_funs.R")
date <- 20140930
shfe <- shfe_grab(date)
dce <- dce_grab(date)
czce <- czce_grab(date)
cffex <- cffex_grab(date)
inherits(xml)
source("R files/grab_funs.R")
shfe <- shfe_grab(date)
dce <- dce_grab(date)
czce <- czce_grab(date)
cffex <- cffex_grab(date)
dce
date <- 20130101
shfe <- shfe_grab(date)
dce <- dce_grab(date)
czce <- czce_grab(date)
cffex <- cffex_grab(date)
shfe
dce
czce
cffex
library(RSQLite)
library(pipeR)
source("R files/grab_funs.R")
dates <- seq(from=as.Date("2014-09-01"), to=as.Date("2014-09-30"), by=1) %>>%
stringr::str_replace_all( pattern="-", replacement="")
conn <- dbConnect(SQLite(), "dataGrab/dbGrab.sqlite")
conn <- dbConnect(SQLite(), "dataGrab/dbGrab/dbGrab.sqlite")
dbDisconnect(conn)
dbDisconnect(conn)
conn <- dbConnect(SQLite(), "dataGrab/dbGrab/dbGrab.sqlite")
SQLite()
conn <- dbConnect(SQLite(), "dataGrab/dbGrab/dbGrab.sqlite")
dce[1]
source("shfe.R")
source("R files/shfe.R")
source("R files/shfe.R")
dbDisconnect(conn)
library(RSQLite)
library(pipeR)
library(foreach)
source("R files/grab_funs.R")
dates <- seq(rom=as.Date("2013-01-01"), to=as.Date("2014-09-30"), by=1) %>>%
stringr::str_replace_all( pattern="-", replacement="")
dates <- seq(from=as.Date("2013-01-01"), to=as.Date("2014-09-30"), by=1) %>>%
stringr::str_replace_all( pattern="-", replacement="")
conn <- dbConnect(SQLite(), "dbGrab/dbGrab.sqlite")
for( date in dates ){
dce <- dce_grab(date)
if( dce != "Not a Trading Day." ) dbWriteTable(conn, "DCE", dce, append=TRUE)
}
dbDisconnect(conn)
date
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
if( length("ori.dt") == 1 ) {
return("Not a Trading Day.")
} else{
data <- jsonlite::fromJSON(ori.dt)$o_curinstrument
data <- transform(data, DATE = date)
data <- data["小计" != data$DELIVERYMONTH & "" != data$DELIVERYMONTH, ]
names(data) <- tolower(names(data))
data <- transform(data, productid=stringr::str_trim(productid),
productname=stringr::str_trim(productname),
openprice=as.numeric(openprice),
highestprice=as.numeric(highestprice),
lowestprice=as.numeric(lowestprice),
closeprice=as.numeric(closeprice))
return(data)
}
data <- jsonlite::fromJSON(ori.dt)$o_curinstrument
data <- transform(data, DATE = date)
data <- data["小计" != data$DELIVERYMONTH & "" != data$DELIVERYMONTH, ]
names(data) <- tolower(names(data))
data <- transform(data, productid=stringr::str_trim(productid),
productname=stringr::str_trim(productname),
openprice=as.numeric(openprice),
highestprice=as.numeric(highestprice),
lowestprice=as.numeric(lowestprice),
closeprice=as.numeric(closeprice))
head(data)
dt.source <- paste0("http://www.dce.com.cn/PublicWeb/MainServlet?action=Pu00012_download&Pu00011_Input.trade_date=", date, "&Pu00011_Input.variety=all&Pu00011_Input.trade_type=0&Submit2=%CF%C2%D4%D8%CE%C4%B1%BE%B8%F1%CA%BD")
data <- readLines(dt.source)
data <- data[5:length(data)]
data.split <- strsplit(data,"\\s+")
data <- suppressWarnings(data.frame( do.call(rbind, data.split),stringsAsFactors=FALSE ))
data <- subset(data, is.na( stringr::str_extract(as.character(data$X1), "小计") ) )
data <- subset(data, as.character(data$X1) != "总计" )
names(data) <- c("ProductName", "DeliveryMonth", "Open", "High", "Low", "Close",
"PreSettlementPrice", "SettlementPrice", "WinLoss", "WinLoss1",
"Volume", "OpenInterest", "DiffOpenInterest", "Amount")
data <- transform(data, Open=treat(Open), High=treat(High),
Low=treat(Low), Close=treat(Close))
head(data)
data <- transform(data, Open=treat(Open), High=treat(High),
Low=treat(Low), Close=treat(Close),
Date=date)
data <- transform(data, Open=treat(Open), High=treat(High),
Low=treat(Low), Close=treat(Close),
Date=date)
dt.source <- paste0("http://www.czce.com.cn/portal/exchange/", substr(date, 1, 4),
"/datadaily/", date, ".txt")
data <- suppressWarnings( try( read.csv(dt.source), silent = TRUE) )
data <- read.csv(dt.source, skip=1, header=FALSE, sep=",", stringsAsFactors=FALSE)
data <- data[data$V1 != "小计" & data$V1 != "总计", ]
names(data) <- c("IntrumentID", "PreSettlementPrice",
"Open", "High", "Low", "Close", "WinLoss",
"BuyHigh", "SellLow", "Volume", "OpenInterest",
"SettlementPrice", "BuyVolume", "SellVolume")
head(data)
data <- transform(data, Date=date)
dt.source <- paste0("http://www.cffex.com.cn/fzjy/mrhq/",
substr(date, 1, 6), "/", substr(date, 7, 8), "/index.xml")
xml <- suppressWarnings( try( XML::xmlParse(dt.source,isURL = TRUE, ), silent=TRUE ) )
data <- XML::xmlToDataFrame(xml,stringsAsFactors = FALSE)
data <- transform(data, instrumentid = stringr::str_trim(instrumentid),
productid = stringr::str_trim(productid), date=date)
return(data)
data <- jsonlite::fromJSON(ori.dt)$o_curinstrument
data <- transform(data, DATE = date)
data <- data["小计" != data$DELIVERYMONTH & "" != data$DELIVERYMONTH, ]
names(data) <- tolower(names(data))
data <- transform(data, productid=stringr::str_trim(productid),
productname=stringr::str_trim(productname),
openprice=as.numeric(openprice),
highestprice=as.numeric(highestprice),
lowestprice=as.numeric(lowestprice),
closeprice=as.numeric(closeprice))
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
data <- jsonlite::fromJSON(ori.dt)$o_curinstrument
data <- transform(data, DATE = date)
data <- data["小计" != data$DELIVERYMONTH & "" != data$DELIVERYMONTH, ]
names(data) <- tolower(names(data))
data <- transform(data, productid=stringr::str_trim(productid),
productname=stringr::str_trim(productname),
openprice=as.numeric(openprice),
highestprice=as.numeric(highestprice),
lowestprice=as.numeric(lowestprice),
closeprice=as.numeric(closeprice))
head(data)
dt.source <- paste0("http://www.shfe.com.cn/data/dailydata/kx/kx", date, ".dat")
ori.dt <- suppressWarnings( readLines(con = dt.source, encoding = "UTF-8") )
ori.dt
data <- jsonlite::fromJSON(ori.dt)$o_curinstrument
data <- transform(data, DATE = date)
data <- jsonlite::fromJSON(ori.dt)$o_curinstrument
data <- data["小计" != data$DELIVERYMONTH & "" != data$DELIVERYMONTH, ]
names(data) <- tolower(names(data))
data <- transform(data, productid=stringr::str_trim(productid),
productname=stringr::str_trim(productname),
openprice=as.numeric(openprice),
highestprice=as.numeric(highestprice),
lowestprice=as.numeric(lowestprice),
closeprice=as.numeric(closeprice),
date=date)
data
